{% extends "icommons_ui/base_datatables.html" %}
{% load crispy_forms_tags %}

{% block page_title %} {% block tool_title %} iSites Export Tool {% endblock tool_title %} {% endblock page_title %}

{% block content %}

  <div class="panel-group spacer" id="policy-accordion">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">

        </h4>
        <p>
        Before using this tool to export iSites content, review the <a data-toggle="collapse" data-parent="policy-accordion" href="#policy-collapse">special access terms</a> you have agreed to as a school partner.  Use this tool to access only the information that you need to perform your duties as a Harvard employee, and please note that your actions in this system are logged.
        </p>
      </div>
      <div class="panel-collapse collapse" id="policy-collapse">
        <div class="panel-body">
        <h4>Confidentiality Agreement</h4>
        <p>
        I have been employed by Harvard University to perform duties requiring the export of iSites content. In consideration of my employment by Harvard, I agree as follows:
        </p>
        <ol>
          <li>I understand that in the course of my employment access I may have access to Confidential Information belonging to Harvard. For purposes of this Agreement, "Confidential Information" means all data or information not generally known outside of my group at Harvard or outside of Harvard, whether prepared or developed by or for Harvard or received by Harvard from an outside source. Without limiting the scope of this definition, Confidential Information includes but is not limited to HUID, social security number, date of birth, name, contact data, and role-specific information, whether or not labeled or identified as "confidential."</li>

          <li>Except as required by my Harvard employment activities, I shall never, either during my Harvard employment or thereafter, directly or indirectly use, publish, disseminate, or otherwise disclose any Confidential Information acquired in the course of my employment activities without the prior written consent of Harvard.</li>

          <li>I agree that I will access only the Confidential Information that I need to perform my duties as a Harvard employee.</li>
        </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="row spacer">
    {% crispy form %}
    <div class="col-sm-4">
        {% if showing_archive %}
          <a class="pull-right" href="{% url 'et:job_list' %}">Show Current</a>
        {% else %}
          <a class="pull-right" href="{% url 'et:job_list_archive' %}">Show Archived</a>
        {% endif %}
    </div>
  </div>

  <table id="joblist_tbl" cellpadding="0" cellspacing="0" border="0" class="datatable table table-striped table-bordered">
    <thead>
       <tr>
           <th>Site</th>
           <th>Created On</th>
           <th>Created By</th>
           <th>Status</th>
           <th>Output</th>
       </tr>
    </thead>
    <tbody>
    {% for job in jobs %}
        <tr>
            <td><span>{{ job.site_keyword }}</span></td>
            <td><span data-sort="{{ job.created_at|date:"U" }}">{{ job.created_at }}</span></td>
            <td><span>
              {% with exporter=job.person %}
                  {{ exporter.name_first}} {{ exporter.name_last }}
              {% endwith %}
            </span></td>
            <td><span>{{ job.status }}</span></td>
            <td>
              <span>
                  {% if job.is_complete %}
                    <a target="_blank" href="{% url 'et:download_export_file' export_filename=job.output_file_name %}"><i class="fa fa-download"></i> {{ job.output_file_name }}</a>
                  {% else %}
                    {{ job.output_message }}
                  {% endif %}
              </span>
            </td>
        </tr>
    {% endfor %}
    </tbody>
  </table>
{% endblock %}

{% block stylesheet %}
    {{ block.super }}
    <style>
      .form-inline .btn { vertical-align: top}
      #div_id_site_keyword { width:50%; }
      .spacer { margin-bottom: 40px; }
    </style>
{% endblock %}

{% block javascript %}
    {{ block.super }}
    <script type="text/javascript">
      jQuery(function($) {
          var oTable = $('#joblist_tbl').dataTable({
              "aoColumnDefs": [
                  { "sType": "data-sort-numeric", "aTargets": [ 1 ] }
              ],
              "aaSorting": [[ 1, 'desc' ]],
              "oLanguage": {
                "sSearch": "Search"
              }
          });
      });
    </script>    
{% endblock %}
